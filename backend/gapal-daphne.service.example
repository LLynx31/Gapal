# Fichier de service systemd pour Daphne (WebSocket)
# À placer dans: /etc/systemd/system/gapal-daphne.service
#
# Installation:
# sudo cp gapal-daphne.service.example /etc/systemd/system/gapal-daphne.service
# sudo systemctl daemon-reload
# sudo systemctl enable gapal-daphne
# sudo systemctl start gapal-daphne

[Unit]
Description=Gapal Daphne WebSocket Service
After=network.target redis-server.service
Requires=redis-server.service

[Service]
Type=simple
User=Nycaise
Group=www-data
WorkingDirectory=/home/Nycaise/web/api.gapal.tangagroup.com/app/backend

# Charger les variables d'environnement depuis le fichier .env
EnvironmentFile=/home/Nycaise/web/api.gapal.tangagroup.com/app/backend/.env
Environment="PATH=/home/Nycaise/web/api.gapal.tangagroup.com/app/backend/venv/bin"
Environment="DJANGO_SETTINGS_MODULE=config.settings.production"

ExecStart=/home/Nycaise/web/api.gapal.tangagroup.com/app/backend/venv/bin/daphne \
    -b 127.0.0.1 \
    -p 8001 \
    --access-log /home/Nycaise/web/api.gapal.tangagroup.com/logs/daphne-access.log \
    --proxy-headers \
    config.asgi:application

# Redémarrage automatique en cas d'échec
Restart=always
RestartSec=10

# Limites de ressources
LimitNOFILE=65536

# Logs
StandardOutput=journal
StandardError=journal
SyslogIdentifier=gapal-daphne

[Install]
WantedBy=multi-user.target
